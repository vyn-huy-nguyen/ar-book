(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[61],{9888:function(e,a,t){Promise.resolve().then(t.bind(t,8094))},8094:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return k}});var r=t(7437),s=t(2265),i=t(2586),n=t(3539),c=t(6834),l=t(8760),o=t(1428),d=t(3708),u=t(4739),f=t(9376);function m(){let e=(0,i.useLocale)(),a=(0,f.useRouter)(),t=(0,f.usePathname)(),s=r=>{let s=t.replace("/".concat(e),"");a.push("/".concat(r).concat(s)),a.refresh()};return(0,r.jsxs)(l.Z,{children:[(0,r.jsx)(o.ZP,{type:"vi"===e?"primary":"default",icon:(0,r.jsx)(u.Z,{}),onClick:()=>s("vi"),size:"small",children:"\uD83C\uDDFB\uD83C\uDDF3 VI"}),(0,r.jsx)(o.ZP,{type:"en"===e?"primary":"default",icon:(0,r.jsx)(u.Z,{}),onClick:()=>s("en"),size:"small",children:"\uD83C\uDDEC\uD83C\uDDE7 EN"})]})}var p=t(29),g=t.n(p),x=t(8667),h=t(353),v=t(7588);let j={1:{pageId:1,markerImage:"/markers/page1-marker.jpg",targetIndex:0,videos:{en:"/videos/page1-video-vi.mp4",vi:"/videos/page1-video-vi.mp4"},title:{en:"Page 1 - Introduction",vi:"Trang 1 - Giới thiệu"}},2:{pageId:2,markerImage:"/markers/page2-marker.jpg",targetIndex:1,audio:{en:"/audio/page2-audio-en.mp3",vi:"/audio/page2-audio-vi.mp3"},title:{en:"Page 2 - Chapter One",vi:"Trang 2 - Chương Một"}},3:{pageId:3,markerImage:"/markers/page3-marker.jpg",targetIndex:2,videos:{en:"/videos/page3-video-vi.mp4",vi:"/videos/page3-video-vi.mp4"},title:{en:"Page 3 - Chapter Two",vi:"Trang 3 - Chương Hai"}}};function b(e){let{onBack:a}=e,t=(0,i.useTranslations)(),n=(0,i.useLocale)(),c=(0,s.useRef)(null),[l,d]=(0,s.useState)(null),[u,f]=(0,s.useState)(!1),[m,p]=(0,s.useState)(!0),[b,y]=(0,s.useState)("tracking"),[I,k]=(0,s.useState)({aframe:!1,mindar:!1}),[N,w]=(0,s.useState)(!1),D=(0,s.useMemo)(()=>Object.values(j),[]),E=(0,s.useRef)({}),C=(0,s.useRef)({});(0,s.useEffect)(()=>{let e=E.current;return()=>{Z(),Object.values(e).forEach(e=>{e&&(e.pause(),e.src="")})}},[]);let Z=()=>{let e=document.querySelector("video");if(e){let a=e.srcObject;a&&a.getTracks().forEach(e=>e.stop())}};(0,s.useEffect)(()=>{I.aframe&&I.mindar&&c.current&&R()},[I.aframe,I.mindar]);let z=(0,s.useRef)(null),P=(0,s.useRef)(!1),L=(0,s.useRef)("tracking");(0,s.useEffect)(()=>{z.current=l},[l]),(0,s.useEffect)(()=>{P.current=m},[m]),(0,s.useEffect)(()=>{L.current=b},[b]),(0,s.useEffect)(()=>{I.aframe&&I.mindar&&D.forEach(e=>{let a=C.current[e.pageId],t=E.current[e.pageId],r=l===e.pageId&&"found"===b;if(a){if(r&&u){let e=!N||m;a.muted!==e&&(a.muted=e),a.paused&&a.play().catch(()=>{})}else a.paused||a.pause(),a.muted=!0}if(t){if(r&&u&&!a){let e=!N||m;t.muted!==e&&(t.muted=e),t.paused&&t.play().catch(()=>{})}else t.paused||t.pause(),t.muted=!0}})},[l,b,u,m,N,D,I,n]);let R=()=>{D.forEach(e=>{let a=document.querySelector("#target-".concat(e.pageId));a&&(a.addEventListener("targetFound",()=>{console.log("MindAR: Found target ".concat(e.pageId));let a=z.current;null!==a&&a!==e.pageId&&(console.log("Switching from marker ".concat(a," to ").concat(e.pageId,". Resetting all media.")),D.forEach(e=>{let a=C.current[e.pageId],t=E.current[e.pageId];a&&(a.currentTime=0),t&&(t.currentTime=0)})),y("found"),d(e.pageId),f(!0)}),a.addEventListener("targetLost",()=>{console.log("MindAR: Lost target ".concat(e.pageId)),y("lost"),f(!1)}))}),document.body.addEventListener("click",()=>{console.log("Unlocking all media elements silently..."),Promise.all(D.map(e=>{let a=C.current[e.pageId],t=E.current[e.pageId],r=[];return a&&(a.muted=!0,r.push(a.play().then(()=>a.pause()).catch(()=>{}))),t&&(t.muted=!0,r.push(t.play().then(()=>t.pause()).catch(()=>{}))),Promise.all(r)})).then(()=>{console.log("System: All media unlocked and pre-warmed."),w(!0)})},{once:!0})};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.default,{src:"https://aframe.io/releases/1.5.0/aframe.min.js",strategy:"afterInteractive",onLoad:()=>k(e=>({...e,aframe:!0}))}),(0,r.jsx)(x.default,{src:"https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js",strategy:"afterInteractive"}),(0,r.jsx)(x.default,{src:"https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js",strategy:"afterInteractive",onLoad:()=>k(e=>({...e,mindar:!0}))}),(0,r.jsx)(g(),{id:"fb752c06cf37f5e1",children:".a-canvas{z-index:999!important;background-color:transparent!important}video{z-index:-2!important}"}),(0,r.jsxs)("div",{className:"jsx-fb752c06cf37f5e1 relative h-dvh w-full overflow-hidden bg-transparent",children:[(0,r.jsx)("div",{className:"jsx-fb752c06cf37f5e1 absolute left-0 right-0 top-0 z-50 bg-gradient-to-b from-black/70 to-transparent p-4",children:(0,r.jsx)("div",{className:"jsx-fb752c06cf37f5e1 flex items-center justify-between gap-4",children:(0,r.jsx)(o.ZP,{type:"text",icon:(0,r.jsx)(v.Z,{}),onClick:()=>{Z(),a()},className:"flex h-10 items-center px-4 text-white",children:t("navigation.back")})})}),(0,r.jsxs)("div",{ref:c,className:"jsx-fb752c06cf37f5e1 relative z-0 h-full w-full",children:[I.aframe&&I.mindar&&D.map(e=>{var a,t;let s=(null==e?void 0:null===(a=e.videos)||void 0===a?void 0:a[n])||(null==e?void 0:null===(t=e.videos)||void 0===t?void 0:t.vi),i=e.audio?e.audio[n]||e.audio.vi:null;return(0,r.jsxs)("div",{className:"jsx-fb752c06cf37f5e1",children:[s&&(0,r.jsx)("video",{id:"video-".concat(e.pageId),src:s,style:{position:"fixed",top:"-10000px",left:0,width:"300px",height:"169px"},loop:!0,crossOrigin:"anonymous",playsInline:!0,preload:"auto",muted:!0,ref:a=>{C.current[e.pageId]=a,a&&a.setAttribute("webkit-playsinline","true")},className:"jsx-fb752c06cf37f5e1"}),i&&(0,r.jsx)("audio",{id:"audio-".concat(e.pageId),src:i,loop:!0,crossOrigin:"anonymous",preload:"auto",style:{display:"none"},ref:a=>{E.current[e.pageId]=a,a&&console.log("Audio element created for page ".concat(e.pageId,":"),i)},className:"jsx-fb752c06cf37f5e1"})]},e.pageId)}),I.aframe&&I.mindar?(0,r.jsxs)("a-scene",{"mindar-image":"imageTargetSrc: ./targets.mind; filterMinCF:0.0001; filterBeta: 0.001;","color-space":"sRGB",renderer:"colorManagement: true, physicallyCorrectLights","vr-mode-ui":"enabled: false","device-orientation-permission-ui":"enabled: false",embedded:!0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},className:"jsx-fb752c06cf37f5e1",children:[(0,r.jsx)("a-camera",{position:"0 0 0","look-controls":"enabled: false",className:"jsx-fb752c06cf37f5e1"}),D.map(e=>(0,r.jsx)("a-entity",{id:"target-".concat(e.pageId),"mindar-image-target":"targetIndex: ".concat(e.targetIndex),className:"jsx-fb752c06cf37f5e1",children:e.model?(0,r.jsx)("a-gltf-model",{src:e.model,scale:"0.5 0.5 0.5",position:"0 0 0",rotation:"90 0 0","animation-mixer":!0,className:"jsx-fb752c06cf37f5e1"}):e.videos?(0,r.jsx)("a-video",{src:"#video-".concat(e.pageId),width:"1",height:"0.5625",position:"0 0 0.1",rotation:"0 0 0",material:"side: double; transparent: true; opacity: 1;",className:"jsx-fb752c06cf37f5e1"}):null},e.pageId))]}):(0,r.jsx)("div",{className:"jsx-fb752c06cf37f5e1 flex h-full items-center justify-center",children:(0,r.jsx)(h.Z,{size:"large",tip:"Loading MindAR..."})})]}),"found"===b&&(0,r.jsxs)("div",{className:"jsx-fb752c06cf37f5e1 absolute bottom-8 right-4 z-50 flex gap-4",children:[(0,r.jsx)(o.ZP,{shape:"circle",size:"large",type:u?"default":"primary",onClick:()=>{f(!u)},className:"flex h-12 w-12 items-center justify-center border-none bg-white/80 text-xl shadow-lg backdrop-blur",children:u?"⏸️":"▶️"}),(0,r.jsx)(o.ZP,{shape:"circle",size:"large",onClick:()=>{p(!m)},className:"flex h-12 w-12 items-center justify-center border-none bg-white/80 text-xl shadow-lg backdrop-blur",children:m?"\uD83D\uDD07":"\uD83D\uDD0A"})]}),(0,r.jsx)("div",{className:"jsx-fb752c06cf37f5e1 pointer-events-none absolute bottom-0 left-0 right-0 z-40 bg-gradient-to-t from-black/70 to-transparent p-4 pb-8",children:(0,r.jsx)("p",{className:"jsx-fb752c06cf37f5e1 text-center text-sm text-white drop-shadow-lg",children:t("found"===b?"ar.trackingFound":"lost"===b?"ar.trackingLost":"ar.tracking")})})]})]})}let{Title:y,Paragraph:I}=n.default;function k(){let e=(0,i.useTranslations)(),[a,t]=(0,s.useState)("home");return"ar"===a?(0,r.jsx)(b,{onBack:()=>{t("home"),window.location.reload()}}):(0,r.jsxs)("div",{className:"flex min-h-dvh items-center justify-center bg-gradient-to-br from-primary-500 to-purple-600 p-4",children:[(0,r.jsx)("div",{className:"absolute right-4 top-4 z-50",children:(0,r.jsx)(m,{})}),(0,r.jsx)(c.Z,{className:"w-full max-w-md shadow-2xl",children:(0,r.jsxs)(l.Z,{direction:"vertical",size:"large",className:"w-full text-center",children:[(0,r.jsx)("div",{children:(0,r.jsx)(y,{level:1,className:"!mb-2 !text-primary-600",children:e("app.title")})}),(0,r.jsx)(o.ZP,{type:"primary",size:"large",icon:(0,r.jsx)(d.Z,{}),onClick:()=>{t("ar")},className:"h-12 w-full text-lg",children:e("qr.scanning")}),(0,r.jsx)(c.Z,{className:"bg-gray-50",children:(0,r.jsxs)(l.Z,{direction:"vertical",size:"small",children:[(0,r.jsx)(u.Z,{className:"text-2xl text-primary-500"}),(0,r.jsx)(I,{className:"!mb-0 text-sm text-gray-600",children:e("qr.instructions")})]})})]})})]})}}},function(e){e.O(0,[381,81,971,117,744],function(){return e(e.s=9888)}),_N_E=e.O()}]);